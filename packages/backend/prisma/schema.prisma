generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Country {
  id               Int       @id @default(autoincrement())
  fir              Int
  debitor1         String
  iso              String
  kst              Int?
  name             String
  comment          String?
  verrkto          String?
  kreditor         String?
  revc             String?
  debitor760       String?
  kreditor760      String?
  stSchlLstRe      String?
  stSchlLstGs      String?
  revc2            String?
  stSchlLiefRe     String?
  emails           String?
  partnerStatus    String?
  zusatz           String?
  finalInterfacing String?
  vertragsende     DateTime?
  debitor10        String?
  paymentBlock     Boolean          @default(false)

  @@index([debitor1])
  @@index([fir])
  @@index([iso])
  @@map("countries")
}

model MasterData {
  id    Int     @id @default(autoincrement())
  uid   String?
  ktod  String
  nam1  String?
  nam2  String?
  nam3  String?
  str   String?
  ort   String?
  plz   String?
  lanb  String?
  payt  Int?

  @@unique([ktod])
  @@index([ktod])
  @@map("master_data")
}

model SapImport {
  id                  Int       @id @default(autoincrement())
  uploadId            Int
  upload              Upload    @relation(fields: [uploadId], references: [id], onDelete: Cascade)
  konto               String
  buchungsschluessel  String?
  belegart            String?
  referenzschluessel3 String?
  referenz            String?
  zuordnung           String?
  buchungsperiode     String?
  buchungsdatum       DateTime?
  belegdatum          DateTime?
  nettofaelligkeit    DateTime?
  kontoGegenbuchung   String?
  sollHabenKennz      String?
  steuerkennzeichen   String?
  belegnummer         String?
  p                   String?
  ausgleichsdatum     DateTime?
  text                String?
  belegkopftext       String?
  buchungsprogramm    String?
  betragHauswaehrung  Float     @default(0)
  hauswaehrung        String?
  type                String?

  @@index([konto])
  @@index([buchungsdatum])
  @@index([type])
  @@index([uploadId])
  @@map("sap_imports")
}

model Upload {
  id               Int         @id @default(autoincrement())
  filename         String
  uploadType       String
  accountingPeriod String?
  uploadedAt       DateTime    @default(now())
  recordCount      Int         @default(0)
  sapImports       SapImport[]

  @@map("uploads")
}

model BillingRun {
  id               Int      @id @default(autoincrement())
  accountingPeriod String
  releaseDate      DateTime
  paymentTermDays  Int      @default(30)
  createdAt        DateTime @default(now())

  @@map("billing_runs")
}

model InterfacingPlan {
  id               Int      @id @default(autoincrement())
  period           String   @unique
  releaseDate      String?
  creator          String?
  reviewer         String?
  updatedAt        DateTime @default(now()) @updatedAt

  @@map("interfacing_plans")
}

model CountryPlanAssignment {
  id        Int    @id @default(autoincrement())
  period    String
  countryId Int
  creator   String?
  reviewer  String?

  @@unique([period, countryId])
  @@index([period])
  @@index([countryId])
  @@map("country_plan_assignments")
}

model CorrectedStatement {
  id        Int      @id @default(autoincrement())
  countryId Int
  period    String
  data      Json
  createdAt DateTime @default(now())

  @@index([countryId, period])
  @@index([period])
  @@map("corrected_statements")
}

model FeedbackItem {
  id          Int              @id @default(autoincrement())
  app         String           @default("Interfacing")
  author      String?
  type        String
  title       String
  description String?
  notes         String?
  jiraUrl       String?
  confluenceUrl String?
  deadlineWeek    String?
  deadlineDate    DateTime?
  deadlineHistory Json?
  assignee        String?
  automationFTE   Float            @default(0)
  codingEffort    Float            @default(0)
  peakPercent     Float            @default(0)
  priority        Int              @default(0)
  status          String           @default("open")
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  comments    FeedbackComment[]

  @@index([status])
  @@index([type])
  @@index([app])
  @@map("feedback_items")
}

model FeedbackComment {
  id         Int          @id @default(autoincrement())
  feedbackId Int
  feedback   FeedbackItem @relation(fields: [feedbackId], references: [id], onDelete: Cascade)
  text       String
  author     String       @default("User")
  createdAt  DateTime     @default(now())

  @@index([feedbackId])
  @@map("feedback_comments")
}

// Streams & Sub-Apps (Coding Team / Home)
model Stream {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  sortOrder   Int      @default(0)
  streamOwner String?
  subApps     SubApp[]

  @@map("streams")
}

model SubApp {
  id              Int     @id @default(autoincrement())
  streamId        Int
  stream         Stream  @relation(fields: [streamId], references: [id], onDelete: Cascade)
  app            String  // display name, e.g. "Interfacing", "FSM-Calculation"
  owner          String?
  status         String  @default("Planning") // Live & IT Approved | Live | Dev | Testing | Planning | Backlog | Blocked
  description    String?
  deadlineTarget  String?
  budgetHours    Float?  // Current Workload p.m. (Automation Controlling)
  isStarted      Boolean @default(false)  // Sub-App "gestartet" → Link/Kachel für alle sichtbar

  @@unique([streamId, app])
  @@index([streamId])
  @@map("sub_apps")
}

model TeamMember {
  id     Int    @id @default(autoincrement())
  name   String
  role   String?
  stream String?

  @@unique([name])
  @@map("team_members")
}
